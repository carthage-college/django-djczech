{% extends "blank.html" %}
{% block css %}
<!-- Core CSS - Include with every page -->
<!-- Latest bootstrap compiled and minified CSS -->
<link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"
    rel="stylesheet">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<!-- Dashboard CSS - Include with every page -->
<link href="//www.carthage.edu/static/vendor/dashboard/css/admin.css"
    rel="stylesheet">
<!-- print CSS -->
<link href="//www.carthage.edu/themes/shared/css/print.css"
    rel="stylesheet">
<link href="//www.carthage.edu/themes/shared/css/forms.css"
    rel="stylesheet" type="text/css" />
<link href="//www.carthage.edu/static/vendor/jquery/ui/datepicker/css/smoothness/jquery-ui-1.10.4.custom.min.css"
    rel="stylesheet" type="text/css" />
{% endblock %}
{% block extra_style %}
<link href="//www.carthage.edu/static/vendor/dashboard/css/plugins/dataTables/jquery.dataTables.min.css"
    rel="stylesheet">
<link href="//www.carthage.edu/static/vendor/dashboard/js/plugins/dataTables/extensions/TableTools/css/dataTables.tableTools.min.css"
    rel="stylesheet">
<link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css"
    rel="stylesheet"/>
<style type="text/css" media="screen, projection">
body {padding-top:0;}
form ol {padding-left:0;}
li.ctrlHolder div ul li {display:inline; padding-right:3px;}
.bg-danger {
    padding: 15px;
}
.form ol li, .form ul li {
    list-style-type: none;
}
dl dt {
    background-color: #ddf3f3;
    color: #003c4b;
    width: 100%;
}
dl dd {
    margin: 2px 0 2px 5px;
}
.green { font-weight:bold; color:green; }
.table-hover > tbody > tr:hover > td.minor { background-color: #ccf; }
.table-striped > tbody > tr:nth-child(2n+1) > td.minor {
    background-color: #ccf;
}
.red {color:#800;}
.green {color:#080;}
div.DTTT {
float: right;
margin-bottom: 1em;
position: relative;
}
.input-group .form-control {
    width: 80%;
}
</style>
{% endblock %}
{% block jquery %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"
    type="text/javascript"></script>
{% endblock %}
<script src="//www.carthage.edu/static/vendor/dashboard/js/plugins/dataTables/jquery.dataTables.js"></script>
{% block javascript %}
<script type="text/javascript">
$(function() {
    $(".required > input").addClass("required");
    $(".required > select").addClass("required");
    $(".required > textarea").addClass("required");
    $(".warning > input").addClass("error");
    $(".warning > select").addClass("error");
    $(".warning > textarea").addClass("error");
    $(".required > ul").parent().parent().find('h3').addClass("required");
});
</script>
{% endblock %}
{% block extra_javascript %}
<script src="//www.carthage.edu/static/vendor/dashboard/js/plugins/dataTables/extensions/TableTools/js/dataTables.tableTools.min.js"></script>
<script src="//www.carthage.edu/static/vendor/dashboard/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
<script src="//www.carthage.edu/static/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script src="//www.carthage.edu/static/vendor/js/spin.min.js"
    type="text/javascript"></script>
<script src="https://malsup.github.io/min/jquery.blockUI.min.js"
    type="text/javascript"></script>
<script>
    $(function() {
        /* spinner */
        var opts = {
            lines: 13, // The number of lines to draw
            length: 20, // The length of each line
            width: 10, // The line thickness
            radius: 30, // The radius of the inner circle
            corners: 1, // Corner roundness (0..1)
            rotate: 0, // The rotation offset
            direction: 1, // 1: clockwise, -1: counterclockwise
            color: '#000', // #rgb or #rrggbb or array of colors
            speed: 1, // Rounds per second
            trail: 60, // Afterglow percentage
            shadow: false, // Whether to render a shadow
            hwaccel: false, // Whether to use hardware acceleration
            className: 'search-results', // The CSS class to assign to spinner
            zIndex: 2e9, // The z-index (defaults to 2000000000)
            top: '50px', // Top position relative to parent in px
            left: 'auto' // Left position relative to parent in px
        };
        var target = document.getElementById("cheques-data-panel");
        var spinner = new Spinner(opts).spin(target);
        spinner.stop(target);

        /*  Initialise the DataTables:
            we assign it to variable 'table' so that we can use it for
            the 'on change' event handler below. if we do not do it this
            way, then the 'on change' event does not work for items after
            page 1.
        */
        var table = $('#cheques-data').dataTable({
            serverSide: true,
            filter: false,
            processing: true,
            ajax: {
                url: "{% url 'cheque_ajax' %}",
                beforeSend: function(){
                    spinner.spin(target);
                }
            },
            drawCallback: function(settings) {
                spinner.stop(target);
                /* x-editable jquery plugin */
                $.fn.editable.defaults.mode = 'inline';
                $('.xeditable').editable({
                    url: "{% url 'set_val' %}",
                    emptytext: "Click to edit",
                    params: function (params) {
                        params.model = $(this).attr("data-model");
                        params.pk = $(this).attr("data-pk");
                        return params
                    },
                    success: function(response, newValue) {
                        if (response == "success") {
                            $.growlUI('Success', "Data saved.");
                        } else {
                            $.growlUI('Error', response);
                        }
                    }
                });
            },
            columns: [
                {
                    "data": "jbchkno",
                    "render": function(data, type, row){
                        return $("<div>").append($("<a/>").attr("href", row.DT_RowData.link).text(data)).html();
                    }
                },
                {
                    "data": "jbstatus",
                    "render": function(data, type, row){
                        $ren = $("<div>").append('<a data-name="jbstatus" href="#" data-pk="' + row.DT_RowData.pk + '" data-model="Cheque" class="xeditable">' + data + '</a>').html();
                        return $ren;
                    }
                },
                { "data": "jbstatus_date" },
                { "data": "jbimprt_date" },
                {
                    "data": "jbaction",
                    "render": function(data, type, row){
                        $ren = $("<div>").append('<a data-name="jbaction" href="#" data-pk="' + row.DT_RowData.pk + '" data-model="Cheque" class="xeditable">' + data + '</a>').html();
                        return $ren;
                    }
                },
                { "data": "jbaccount" },
                { "data": "jbamount" },
                { "data": "jbissue_date"},
                {
                    "data": "jbpostd_dat",
                    "render": function(data, type, row){
                        $ren = $("<div>").append('<a data-name="jbpostd_dat" href="#" data-pk="' + row.DT_RowData.pk + '" data-model="Cheque" class="xeditable">' + data + '</a>').html();
                        return $ren;
                    }
                },
                {
                    "data": "jbpayee",
                    "render": function(data, type, row){
                        $ren = $("<div>").append('<a data-name="jbpayee" href="#" data-pk="' + row.DT_RowData.pk + '" data-model="Cheque" class="xeditable">' + data + '</a>').html();
                        return $ren;
                    }
                },
                { "data": "jbseqno" }
            ],
            //"order": [[ 0, "asc" ]],
            lengthMenu: [
                [25, 50, 100, 250, 500, 1000],
                [25, 50, 100, 250, 500, 1000]
            ]
        })
    });
</script>
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">
                Check Reconciliation Data
                <small>
                    <span class="minor">Lavener rows are exceptions</span>
                    <i class="fa fa-star green"></i> = Star
                </small>
            </h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h2>Toggle</h2>
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body" id="data-panel">
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
{% endblock content %}
